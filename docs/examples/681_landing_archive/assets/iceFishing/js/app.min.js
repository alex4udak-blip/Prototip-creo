class iceFishing{constructor(){this.startButton=document.getElementById("go-btn"),this.spinButton=document.getElementById("spin-btn"),this.game=document.getElementById("game"),this.field=document.getElementById("game-field"),this.wheel=document.getElementById("game-wheel"),this.winButton=document.getElementById("win-button-modal"),this.modal=document.getElementById("modal"),this.controls=document.getElementById("game-controls"),this.effectsContainer=document.getElementById("effects"),this.effectsImage=document.getElementById("effects-image"),this.spinButtonDefault=document.getElementById("spin-btn-default-text"),this.spinButtonNext=document.getElementById("spin-btn-next-text"),this.winSoundName=document.body.dataset.winSound||"1",this.isUseSound="false"!==document.body.dataset.useSound,this.spinSound=new Audio("../../assets/general/sound/wheel-spin-click-slow-down-101152.mp3"),this.winSound=new Audio("../../assets/general/sound/you-win-sequence-1-183948.mp3"),this.winSound2=new Audio(`../../assets/general/sound/winSound/${this.winSoundName}.mp3`),this.loseSound=new Audio("../../assets/general/sound/chicken-zombies-lose.mp3"),this.rate=this.game.dataset.rate,this.spins=Number(this.game.dataset.spins),this.crashes=this.game.dataset.crashes.split(",").map(Number),this.currentStep=0,this.stepTime=3e3}initGame(){this.calculateFontSize(this.startButton,{threshold:15,step:.02,minPercent:.6}),this.calculateFontSize(this.spinButton,{threshold:15,step:.02,minPercent:.6}),this.calculateFontSize(this.winButton,{threshold:30,step:.02,minPercent:.6}),window.addEventListener("placementOpenModal",()=>this.showModal()),this.startButton.addEventListener("click",()=>this.initStart())}startGame(){this.game.classList.add("is--started"),this.spinButton.addEventListener("click",()=>this.spin())}initStart(){window.isMobile&&window.pushPlacement&&!window.firstClick&&0===this.currentStep?window.dispatchEvent(new CustomEvent("placementFirstClick",{detail:[this.startGame.bind(this)]})):this.startGame()}spin(){this.currentStep+=1,this.spinWheel(),this.playSound(this.spinSound),this.disableControls(this.stepTime),1===this.currentStep&&this.spins>1&&this.toggleSpinText(),this.spins===this.currentStep&&this.handleWin()}spinWheel(){this.spins===this.currentStep?this.wheel.classList.add("is--spin-win"):this.wheel.classList.add(`is--spin-${this.currentStep}`)}handleWin(){this.disableControls(),setTimeout(()=>{this.playSound(this.winSound),this.game.classList.add("is--win"),setTimeout(()=>{this.game.classList.add("is--animation-step-1"),setTimeout(()=>{this.game.classList.add("is--animation-step-2"),setTimeout(()=>{this.game.classList.add("is--animation-step-3"),setTimeout(()=>{this.showEffects(),this.triggerShowModal(),this.playSound(this.winSound2)},7e3)},2e3)},1500)},2e3)},this.stepTime)}disableControls(t=null){this.game.classList.add("is--disabled"),t&&setTimeout(()=>{this.game.classList.remove("is--disabled")},t)}toggleSpinText(){setTimeout(()=>{this.spinButtonDefault&&this.spinButtonNext&&(this.spinButtonDefault.style.display="none",this.spinButtonNext.style.display="block",this.calculateFontSize(this.spinButton,{threshold:15,step:.02,minPercent:.6}))},this.stepTime)}showEffects(t=0,e=1500){this.effectsContainer.classList.add("visible"),setTimeout(()=>{const t=document.createElement("div");t.style.backgroundImage=`url(${this.effectsImage.src})`,t.classList.add("effects__block"),this.effectsContainer.appendChild(t),setTimeout(()=>{this.effectsContainer.classList.remove("visible"),this.effectsContainer.classList.add("hidden")},e)},t)}showModal(){document.body.classList.add("is--modal-open"),this.modal.classList.add("is--active")}playSound(t,e=0,s=1){this.isUseSound&&setTimeout(()=>{t.muted=!1,t.currentTime=0,t.volume=s,t.play().catch(t=>{console.error("Помилка при відтворенні аудіо: ",t)})},e)}triggerShowModal(t=0){setTimeout(()=>{window.dispatchEvent(new Event("placementOpenModal"))},t)}calculateFontSize(t,e={threshold:20,step:.02,minPercent:.5}){if(!t)return;const s=t.querySelector("span");if(s){const t=String(s.innerHTML).length,i=window.getComputedStyle(s),n=parseFloat(i.getPropertyValue("font-size")),a=n,o=n*e.minPercent,d=Math.max(0,t-e.threshold),h=Math.max(a-d*(n*e.step),o);s.style.fontSize=`${h}px`}}}document.addEventListener("DOMContentLoaded",()=>{(new iceFishing).initGame()});